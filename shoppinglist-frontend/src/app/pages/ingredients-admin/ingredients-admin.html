<section class="w-full p-6">
  <div class="card bg-base-100 shadow-xl w-full">
    <div class="card-body">
      <div class="flex items-center gap-3 mb-4">
        <span class="badge badge-primary badge-outline">Admin</span>
        <h1 class="card-title text-2xl">Ingredients</h1>
        <button class="btn btn-sm ml-auto" (click)="loadItems()">Refresh</button>
      </div>

      @if (error()) {
        <div class="alert alert-error mb-4">
          <span>{{ error() }}</span>
        </div>
      }

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <section class="space-y-3">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">Create item</h2>
            @if (metaLoading()) {
              <span class="loading loading-spinner loading-xs" aria-label="Loading metadata"></span>
            }
          </div>

          <label class="form-control w-full">
            <div class="label"><span class="label-text">Name</span></div>
            <input class="input input-bordered w-full" placeholder="e.g. Tomatoes" [formControl]="createForm.controls.name" />
          </label>

          <label class="form-control w-full">
            <div class="label"><span class="label-text">Category</span></div>
            <input
              class="input input-bordered w-full"
              list="category-options"
              placeholder="e.g. Vegetables"
              [formControl]="createForm.controls.category"
            />
            <datalist id="category-options">
              @for (category of categories(); track category) {
                <option [value]="category"></option>
              }
            </datalist>
          </label>

          <label class="form-control w-full">
            <div class="label"><span class="label-text">Unit</span></div>
            <input class="input input-bordered w-full" list="unit-options" placeholder="e.g. pcs" [formControl]="createForm.controls.unit" />
            <datalist id="unit-options">
              @for (unit of units(); track unit) {
                <option [value]="unit"></option>
              }
            </datalist>
          </label>

          <button class="btn btn-primary w-full" (click)="addItem()" [disabled]="submitting()">Add item</button>
        </section>

        <section class="space-y-3">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">Existing items</h2>
            @if (itemsLoading()) {
              <span class="loading loading-spinner loading-xs" aria-label="Loading items"></span>
            }
          </div>

          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Unit</th>
                  <th class="text-right">Actions</th>
                </tr>
              </thead>
              <tbody>
                @for (item of pagedItems(); track item.name + '::' + item.unit) {
                  <tr>
                    <td class="font-medium">{{ item.name }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.unit }}</td>
                    <td class="text-right space-x-2">
                      <button class="btn btn-ghost btn-xs" (click)="openEdit(item)">Edit</button>
                      <button class="btn btn-ghost btn-xs text-error" (click)="deleteItem(item)" [disabled]="submitting()">Delete</button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          <div class="flex flex-wrap items-center justify-between gap-3 mt-4">
            <span class="text-sm text-base-content/70">{{ paginationLabel() }}</span>
            <div class="join">
              <button
                class="btn btn-sm join-item"
                type="button"
                (click)="previousPage()"
                [disabled]="currentPage() === 1"
              >
                Previous
              </button>
              @for (page of pageNumbers(); track page) {
                <button
                  class="btn btn-sm join-item"
                  type="button"
                  (click)="changePage(page)"
                  [class.btn-active]="page === currentPage()"
                >
                  {{ page }}
                </button>
              }
              <button
                class="btn btn-sm join-item"
                type="button"
                (click)="nextPage()"
                [disabled]="currentPage() === totalPages()"
              >
                Next
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <dialog #editDialog class="modal" (close)="closeEdit()">
    <div class="modal-box w-11/12 max-w-xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" aria-label="Close">âœ•</button>
      </form>

      <h3 class="font-bold text-lg">Edit item</h3>

      <div class="space-y-3 mt-4">
        <label class="form-control w-full">
          <div class="label"><span class="label-text">Name</span></div>
          <input class="input input-bordered w-full" [formControl]="editForm.controls.name" />
        </label>

        <label class="form-control w-full">
          <div class="label"><span class="label-text">Category</span></div>
          <input class="input input-bordered w-full" list="category-options" [formControl]="editForm.controls.category" />
        </label>

        <label class="form-control w-full">
          <div class="label"><span class="label-text">Unit</span></div>
          <input class="input input-bordered w-full" list="unit-options" [formControl]="editForm.controls.unit" />
        </label>
      </div>

      <div class="modal-action">
        <button type="button" class="btn btn-primary" (click)="saveEdit()" [disabled]="submitting()">Save</button>
        <form method="dialog">
          <button class="btn">Cancel</button>
        </form>
      </div>
    </div>
  </dialog>
</section>
